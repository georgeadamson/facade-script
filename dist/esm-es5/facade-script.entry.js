var __awaiter=this&&this.__awaiter||function(t,e,r,n){function a(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,i){function o(t){try{c(n.next(t))}catch(e){i(e)}}function s(t){try{c(n["throw"](t))}catch(e){i(e)}}function c(t){t.done?r(t.value):a(t.value).then(o,s)}c((n=n.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(t){return function(e){return c([t,e])}}function c(o){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,a&&(i=o[0]&2?a["return"]:o[0]?a["throw"]||((i=a["return"])&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;if(a=0,i)o=[o[0]&2,i.value];switch(o[0]){case 0:case 1:i=o;break;case 4:r.label++;return{value:o[1],done:false};case 5:r.label++;a=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(o[0]===6&&r.label<i[1]){r.label=i[1];i=o;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(o);break}if(i[2])r.ops.pop();r.trys.pop();continue}o=e.call(t,r)}catch(s){o=[6,s];a=0}finally{n=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};import{r as registerInstance,c as createEvent,h,e as Host,g as getElement}from"./index-1aedce71.js";var clearTimeout=window.clearTimeout;var clearInterval=window.clearInterval;var parseInt=window.parseInt;var SCRIPT_UID_ATTR="data-facadescriptid";var ERROR_MESSAGE={1:"Script triggered but missing src"};var STATUS={IDLE:0,TRIGGERED_BUT_NO_SRC:.1,TRIGGERED:2,WAITING:3,LOADING:4,LOADED:5,READY:6,TIMEOUT:7};var STATUS_NAME={};for(var key in STATUS)STATUS_NAME[STATUS[key]]=key;var globalStatusCode={};var nextUid=0;var FacadeScript=function(){function t(t){var e=this;registerInstance(this,t);this.facadescript=createEvent(this,"facadescript",7);this.once=false;this.global=false;this.trigger="lazy";this.wait=0;this.showWhen="LOADED";this.statusMsg="IDLE";this.status=0;this.uid=nextUid++;this.isOnPage=function(){var t=e,r=t.src,n=t.uid;var a='[src^="'+r+'"]:not(['+SCRIPT_UID_ATTR+"="+n+"])";return Boolean(document.querySelector("script"+a+",iframe"+a))};this.onTrigger=function(){var t=e,r=t.once,n=t.global,a=t.iframe,i=t.wait,o=t.src,s=t.uid,c=t.props,u=t.onLoad,l=t.timeout;e.status=STATUS.TRIGGERED;if(!o){e.error=1;e.status=STATUS.IDLE;return}else if(e.error){e.error=undefined}if(r&&e.isOnPage()){if(statusOfGlobalScript(o)<STATUS.LOADING){globalStatusCode[o]=STATUS.LOADING}e.status=statusOfGlobalScript(o);return}var f=function(){var t;if(r&&e.isOnPage()){e.status=globalStatusCode[o]||(globalStatusCode[o]=STATUS.READY);return}if(n&&!(r&&e.isOnPage())){createElement(a?"iframe":"script",Object.assign((t={src:o},t[SCRIPT_UID_ATTR]=s,t.onLoad=u,t),parseJSON(c)),document.head)}e.status=globalStatusCode[o]=STATUS.LOADING;if(l){e.timeoutId=setTimeout((function(){if(e.status<STATUS.READY){e.status=STATUS.TIMEOUT}}),l)}};if(i){e.status=STATUS.WAITING;setTimeout(f,i)}else{f()}};this.onLoad=function(){if(e.status!==STATUS.TIMEOUT){var t=e,r=t.src,n=t.once,a=t.isReady,i=t.timeout,o=t.timeoutId;clearTimeout(o);if(n)globalStatusCode[r]=STATUS.LOADED;e.status=STATUS.LOADED;awaitScriptReady(a||function(){return true},i).then((function(){return e.status=STATUS.READY})).catch((function(t){return console.error("awaitScriptReady",t)}))}}}t.prototype.onError=function(t){this.errMsg=ERROR_MESSAGE[t]};t.prototype.onStatus=function(t,e){if(t===e)return;var r=this,n=r.debug,a=r.error,i=r.errMsg,o=r.once,s=r.src,c=r.timeoutId,u=r.host;if(c&&t>=STATUS.READY){clearTimeout(c)}if(o&&t>=STATUS.LOADING&&t>statusOfGlobalScript(s)){globalStatusCode[s]=t}var l={code:t,status:STATUS_NAME[t],error:a,errMsg:i,id:u.id,src:s};this.statusMsg=STATUS_NAME[t];this.facadescript.emit(l);if(n){var f=this,S=f.uid,T=f.iframe,d=f.global;console.debug("facadescript:",Object.assign(Object.assign({},l),{uid:S,iframe:T,once:o,global:d}))}};t.prototype.componentWillLoad=function(){this.src=this.srcProd};t.prototype.componentDidLoad=function(){var t=this,e=t.trigger,r=t.once,n=t.onTrigger,a=t.src,i=t.host;var o=e==="now"?n:e==="lazy"?function(){return newIntersectionObserver(n).observe(i)}:typeof e==="function"?e:false;if(o){o(n)}if(r&&this.isOnPage()){if(statusOfGlobalScript(a)<STATUS.LOADING){globalStatusCode[a]=STATUS.LOADING}this.status=statusOfGlobalScript(a)}};t.prototype.render=function(){var t;var e=this,r=e.iframe,n=e.src,a=e.uid,i=e.global,o=e.props,s=e.trigger,c=e.onTrigger,u=e.onLoad,l=e.showWhen,f=e.status,S=e.once;var T;var d=STATUS[String(l).toUpperCase()]||STATUS.LOADED;var p=f<d;if(!i&&f>STATUS.WAITING&&!(S&&this.isOnPage())){var g=r?"iframe":"script";var v=Object.assign((t={src:n,onLoad:u,hidden:p},t[SCRIPT_UID_ATTR]=a,t),parseJSON(o));T=h(g,Object.assign({},v))}var A={onClick:s==="click"&&f<STATUS.TRIGGERED&&c};var b=!p&&f!==STATUS.TIMEOUT;return h(Host,Object.assign({},A),h("div",{class:"facade-script-placeholder",hidden:b},h("slot",null)),T)};Object.defineProperty(t.prototype,"host",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{error:["onError"],status:["onStatus"]}},enumerable:false,configurable:true});return t}();function parseJSON(t){try{return(typeof t==="object"?t:t&&JSON.parse(t))||{}}catch(e){console.error("Error parsing `props`",e,"JSON:",t)}}function createElement(t,e,r){if(e===void 0){e={}}var n=document.createElement(t);Object.entries(e).forEach((function(t){var e=t[0],r=t[1];n.hasOwnProperty(e)||typeof r==="function"?n[e]=r:n.setAttribute(e,r)}));if(r)r.appendChild(n)}var statusOfGlobalScript=function(t){return globalStatusCode[t]||STATUS.IDLE};var newIntersectionObserver=function(t){return new IntersectionObserver((function(e,r){var n=e[0];if(n.isIntersecting){r.disconnect();t()}}))};var awaitScriptReady=function(t,e,r){if(r===void 0){r=200}return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(n){return[2,new Promise((function(n,a){var i;var o=setInterval((function(){if(t()){clearTimeout(i);clearInterval(o);n()}}),parseInt(r)||200);if(e){i=setTimeout((function(){clearInterval(o);a("timeout")}),parseInt(e)||3e4)}}))]}))}))};export{FacadeScript as facade_script};