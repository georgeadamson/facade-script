var __awaiter=this&&this.__awaiter||function(t,e,r,a){function n(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,i){function o(t){try{c(a.next(t))}catch(e){i(e)}}function s(t){try{c(a["throw"](t))}catch(e){i(e)}}function c(t){t.done?r(t.value):n(t.value).then(o,s)}c((a=a.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},a,n,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(t){return function(e){return c([t,e])}}function c(o){if(a)throw new TypeError("Generator is already executing.");while(r)try{if(a=1,n&&(i=o[0]&2?n["return"]:o[0]?n["throw"]||((i=n["return"])&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;if(n=0,i)o=[o[0]&2,i.value];switch(o[0]){case 0:case 1:i=o;break;case 4:r.label++;return{value:o[1],done:false};case 5:r.label++;n=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(o[0]===6&&r.label<i[1]){r.label=i[1];i=o;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(o);break}if(i[2])r.ops.pop();r.trys.pop();continue}o=e.call(t,r)}catch(s){o=[6,s];n=0}finally{a=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};import{r as registerInstance,c as createEvent,h,e as Host,g as getElement}from"./index-d373a0aa.js";var clearTimeout=window.clearTimeout;var clearInterval=window.clearInterval;var parseInt=window.parseInt;var SCRIPT_UID_ATTR="data-facadescriptid";var ERROR_MESSAGE={1:"Script triggered but missing src"};var STATUS={IDLE:0,TRIGGERED_BUT_NO_SRC:.1,TRIGGERED:2,WAITING:3,LOADING:4,LOADED:5,READY:6,TIMEOUT:7};var STATUS_NAME={};for(var key in STATUS)STATUS_NAME[STATUS[key]]=key;var globalStatusCode={};var nextUid=0;var FacadeScript=function(){function t(t){var e=this;registerInstance(this,t);this.facadescript=createEvent(this,"facadescript",7);this.once=false;this.global=false;this.trigger="lazy";this.wait=0;this.showWhen="LOADED";this.statusMsg="IDLE";this.status=0;this.uid=nextUid++;this.isOnPage=function(){var t=e,r=t.src,a=t.uid;var n='[src^="'+r+'"]:not(['+SCRIPT_UID_ATTR+"="+a+"])";return Boolean(document.querySelector("script"+n+",iframe"+n))};this.onTrigger=function(){var t=e,r=t.once,a=t.global,n=t.iframe,i=t.wait,o=t.src,s=t.uid,c=t.props,u=t.onLoad,l=t.timeout;e.status=STATUS.TRIGGERED;if(!o){e.error=1;e.status=STATUS.IDLE;return}else if(e.error){e.error=undefined}if(r&&e.isOnPage()){if(statusOfGlobalScript(o)<STATUS.LOADING){globalStatusCode[o]=STATUS.LOADING}e.status=statusOfGlobalScript(o);return}var f=function(){var t;if(r&&e.isOnPage()){e.status=globalStatusCode[o]||(globalStatusCode[o]=STATUS.READY);return}if(a&&!(r&&e.isOnPage())){createElement(n?"iframe":"script",Object.assign((t={src:o},t[SCRIPT_UID_ATTR]=s,t.onLoad=u,t),parseJSON(c)),document.head)}e.status=globalStatusCode[o]=STATUS.LOADING;if(l){e.timeoutId=setTimeout((function(){if(e.status<STATUS.READY){e.status=STATUS.TIMEOUT}}),l)}};if(i){e.status=STATUS.WAITING;setTimeout(f,i)}else{f()}};this.onLoad=function(){if(e.status!==STATUS.TIMEOUT){var t=e,r=t.src,a=t.once,n=t.isReady,i=t.timeout,o=t.timeoutId;clearTimeout(o);if(a)globalStatusCode[r]=STATUS.LOADED;e.status=STATUS.LOADED;awaitScriptReady(n||function(){return true},i).then((function(){return e.status=STATUS.READY})).catch((function(t){return console.error("awaitScriptReady",t)}))}}}t.prototype.onError=function(t){this.errMsg=ERROR_MESSAGE[t]};t.prototype.onStatus=function(t,e){if(t===e)return;var r=this,a=r.debug,n=r.error,i=r.errMsg,o=r.once,s=r.src,c=r.timeoutId,u=r.host;if(c&&t>=STATUS.READY){clearTimeout(c)}if(o&&t>=STATUS.LOADING&&t>statusOfGlobalScript(s)){globalStatusCode[s]=t}var l={code:t,status:STATUS_NAME[t],error:n,errMsg:i,id:u.id,src:s};this.statusMsg=STATUS_NAME[t];this.facadescript.emit(l);if(a){var f=this,S=f.uid,T=f.iframe,d=f.global;console.debug("facadescript:",Object.assign(Object.assign({},l),{uid:S,iframe:T,once:o,global:d}))}};t.prototype.componentWillLoad=function(){this.src=this.srcProd};t.prototype.componentDidLoad=function(){var t=this,e=t.trigger,r=t.once,a=t.onTrigger,n=t.src,i=t.host;var o=e==="now"?a:e==="lazy"?function(){return newIntersectionObserver(a).observe(i)}:typeof e==="function"?e:false;if(o){o(a)}if(r&&this.isOnPage()){if(statusOfGlobalScript(n)<STATUS.LOADING){globalStatusCode[n]=STATUS.LOADING}this.status=statusOfGlobalScript(n)}};t.prototype.render=function(){var t;var e=this,r=e.iframe,a=e.src,n=e.uid,i=e.global,o=e.props,s=e.trigger,c=e.onTrigger,u=e.onLoad,l=e.showWhen,f=e.status,S=e.once;var T;var d=STATUS[String(l).toUpperCase()]||STATUS.LOADED;var p=f<d;if(!i&&f>STATUS.WAITING&&!(S&&this.isOnPage())){var g=r?"iframe":"script";var v=Object.assign((t={src:a,onLoad:u,hidden:p},t[SCRIPT_UID_ATTR]=n,t),parseJSON(o));T=h(g,Object.assign({},v))}var A={onClick:s==="click"&&f<STATUS.TRIGGERED&&c};var b=!p&&f!==STATUS.TIMEOUT;return h(Host,Object.assign({},A),h("div",{class:"facade-script-placeholder",hidden:b},h("slot",null)),T)};Object.defineProperty(t.prototype,"host",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{error:["onError"],status:["onStatus"]}},enumerable:false,configurable:true});return t}();function parseJSON(t){try{return(typeof t==="object"?t:t&&JSON.parse(t))||{}}catch(e){console.error("Error parsing `props`",e,"JSON:",t)}}function createElement(t,e,r){if(e===void 0){e={}}var a=document.createElement(t);Object.entries(e).forEach((function(t){var e=t[0],r=t[1];a.hasOwnProperty(e)||typeof r==="function"?a[e]=r:a.setAttribute(e,r)}));if(r)r.appendChild(a)}var statusOfGlobalScript=function(t){return globalStatusCode[t]||STATUS.IDLE};var newIntersectionObserver=function(t){return new IntersectionObserver((function(e,r){var a=e[0];if(a.isIntersecting){r.disconnect();t()}}))};var awaitScriptReady=function(t,e,r){if(r===void 0){r=200}return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(a){return[2,new Promise((function(a,n){var i;var o=setInterval((function(){if(t()){clearTimeout(i);clearInterval(o);a()}}),parseInt(r)||200);if(e){i=setTimeout((function(){clearInterval(o);n("timeout")}),parseInt(e)||3e4)}}))]}))}))};export{FacadeScript as facade_script};